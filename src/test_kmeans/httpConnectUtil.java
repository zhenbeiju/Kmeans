package test_kmeans;

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;
import java.util.HashMap;

public class httpConnectUtil {

    // public static final String GET_URL = " http://localhost:8080/demo/  ";
    //
    // public static final String POST_URL = " http://localhost:8080/demo/  ";

    public static String readContentFromGet(String url, HashMap<String, String> head) throws IOException {

        // ??????get?????????URL???????????????URLEncoder.encode???????????????????????????????????????

        URL getUrl = new URL(url);

        // ???????????????URL??????????????????URL.openConnection()???????????????
        // URL???????????????????????????URLConnection????????????????????????????????????URL?????????http?????????????????????????????????HttpURLConnection

        HttpURLConnection connection = (HttpURLConnection) getUrl.openConnection();

        if (head != null) {
            for (String s : head.keySet()) {
                connection.addRequestProperty(s, head.get(s));
            }
        }

        // ????????????????????????????????????????????????
        connection.setRequestProperty("token", "1411_0911217fd688d392ad723103b944a5a4");
        connection.connect();

        // ?????????????????????????????????Reader?????????????????????

        BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));

        String lines;
        StringBuffer result = new StringBuffer();
        while ((lines = reader.readLine()) != null) {

            result.append(lines);

        }

        reader.close();

        // ????????????

        connection.disconnect();

        return result.toString();

    }

    public static void readContentFromPost(String posturl, HashMap<String, String> head, String content)
            throws IOException {

        // Post?????????url??????get??????????????????????????????

        URL postUrl = new URL(posturl);

        // ????????????

        HttpURLConnection connection = (HttpURLConnection) postUrl.openConnection();

        // ?????????????????????????????????false

        connection.setDoOutput(true);

        connection.setDoInput(true);

        // ??????????????????????????????GET

        connection.setRequestMethod("POST");

        // Post ????????????????????????

        connection.setUseCaches(false);

        // URLConnection.setFollowRedirects???static
        // ???????????????????????????URLConnection?????????

        // connection.setFollowRedirects(true);

        // URLConnection.setInstanceFollowRedirects
        // ??????????????????????????????????????????

        connection.setInstanceFollowRedirects(true);

        // ???????????????Content-type????????????application/x-
        // www-form-urlencoded?????????????????????urlencoded????????????form????????????????????????????????????????????????????????????URLEncoder.encode????????????

        // connection.setRequestProperty(" Content-Type ",
        // " application/x-www-form-urlencoded ");
        if (head != null) {
            for (String s : head.keySet()) {
                connection.addRequestProperty(s, head.get(s));
            }
        }

        // ????????????postUrl.openConnection()???????????????????????????
        // connect???????????????

        // ???????????????connection.getOutputStream()????????????????????????
        // connect()???????????????????????????

        // connection.connect();

        DataOutputStream out = new DataOutputStream(connection

        .getOutputStream());

        // ?????????????????????get???URL???'?'???????????????????????????

        // String content = " firstname= " +
        // URLEncoder.encode(" ??????????????? ",
        // " utf-8 ");

        // DataOutputStream.writeBytes??????????????????16??????
        // unicode?????????8?????????????????????????????????

        out.writeBytes(content);

        out.flush();

        out.close(); // flush and close

        BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));

        String line;

        while ((line = reader.readLine()) != null) {

            System.out.println(line);

        }

        reader.close();

    }

    public static void main(String[] args) {

        // TODO Auto-generated method stub
        try {

            readContentFromGet("http://api.reco4life.com/v/api.1.1/item_list?user_name=010001797", null);
            readContentFromGet(
                    "http://api.reco4life.com/v/api.1.1/item_switch?user_name=010001797&sn=010001797&status=0", null);
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

    }

}
